<!DOCTYPE html>
<html lang="en">

<head>
  <title>Personal Locker Management</title>

  <meta charset="utf-8" />


  <link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.css" />

  <!--This file works as the overall stylesheet for the project-->
  <link type="text/css" rel="stylesheet" href="style/lockermanagement.css">

  <!--This file works as the overall stylesheet for lockermap-->

  <style>
    .card{color: black}

    body {
  background-color: aqua;
}
    body {
      height: 100vmax;
      background-image: url(../img/lockermanagement_background2.jpg);
    }

    /*header includes logo and */
    .spinner-grow {
      float: left;
      filter: invert(100%);
    }

    #headerContainer {
      width: 100vw;
      position: relative;
      top: 0vh;
      text-align: center;
      display: inline-block;
      height: 10vh;
      margin: 0vh;

    }

    #header {

      position: relative;
      top: 0vh;
      text-align: center;
      display: inline;
      margin: 0vh;
    }

    #promptBox {
      top: 1vh;
      margin-top: 0vh;
      position: relative;
      font-size: 3.5vh;
      height: 21vh;
      margin-bottom: 0vh;
      padding-bottom: 0vh;
      filter: opacity(80%)
    }

    #logo {

      position: absolute;
      left:-10vw;
      width: calc(10vh - 2vh);
      top: 1vh;
      padding: 0vh;
      margin: 0vh;
    }

#showCurrent{
  width: 60vw;
  z-index: 100;
  position: fixed;
  left: 30vw;
  top: 0vh;
  background-color: beige;

}



    #profile {
      position: relative;
      width: calc(10vh - 1vh);
      float: right;
      clip-path:circle(48%);
    }

    /*the promptbox tells the user what to do*/


    #dragBoxDiv {
      display: block;
      position: absolute;
      margin-top: 0vh;
      font-size: 12pt;
      width: 100vw;
      height: 50vh;
      margin-bottom: 0vh;
      filter: opacity(75%);
    }

    #dragBox {
      display: block;
      position: relative;
      margin-top: 1vh;
      font-size: 12pt;
      width: 100vw;
      height: 38vh;
      margin-bottom: 0vh;
    }



    #leftCard {
      width: 48vw;
      height: 45vh;
      float: left;
      margin-right: 0.5vw;
      margin-bottom: 0vh;
    }

    #rightCard {
      width: 48vw;
      height: 45vh;
      float: right;
      margin-bottom: 0vh;
      margin-left: 1vw;
    }

    #dragBoxButtons {
      height: 6vh;
      width: 100vw;
      margin-top: 0vh;
      padding: 0vh;
    }

    #dragBoxButtons {
      display: block;
      position: relative;
      bottom: 0vh;
      font-size: 12pt;
      width: 100vw;
      height: 20vh;
      margin-bottom: 0vh;
    }

    #picView {
      float: left;
      font-size: 2.5vh;
      width: 35vw;
      height: 6vh;
      margin: 0vh;
    }

    #skip {
      float: right;
      width: 25vw;
      height: 6vh;
      font-size: 3vh;
    }

    #bottomToolBar {
      position: absolute;
      width: 100vw;
      top: 90vh;
      left: 0vw;
      display: flex;
      margin: 0px;

    }

    #mapBtn {
      width: 19vw;
    }

    #mapBtn:hover {
      width: 20vw;
      filter: saturate(5.5);
    }

    #checklistBtn {
      width: 20vw;
    }

    #checklistBtn:hover {
      filter: saturate(5.5);
      width: 20.5vw;
    }

    #unlockBtn {

      width: 20vw;
    }

    #unlockBtn:hover {
      filter: saturate(5.5);
      width: 20.5vw;
    }

    #checkContentBtn{
      width: 20vw;
    }

    #checkContentBtn:hover{
      filter: saturate(5.5);
      width: 20.5vw;
    }


    .bottomToolBarButtonDiv {
      display: flex;
      width: 20vw;
    }

#sectionChoice{
  margin-top: 5vh;
  display: grid;
  width: 100vw;
  height: 60vh;
  grid-template-areas:
            "NE NE SE SE"
            "NW NW SW SW";

  color: aliceblue;
  font-size: 10pt;
  text-align: center;
}

#NW{
  grid-area: NW;
  background: blue;
  border: 2px solid black;
  margin: 1vw;
  border-radius: 5vw;
}

#NE{
  grid-area: NE;
  background: green;
  border: 2px solid black;
  margin: 1vw;
  border-radius: 5vw;
}

#SW{
  grid-area: SW;
  background: orange;
  border: 2px solid black;
  margin: 1vw;
  border-radius: 5vw;
}

#SE{
  grid-area: SE;
  background: red;
  border: 2px solid black;
  margin: 1vw;
  border-radius: 5vw;
}

#buildings{
  color: aliceblue;
  font-size: 12pt;

}

#SW-buildings{
  display: inline-flex;
}

#NE-buildings{
  display: inline-flex;
}

#SE-buildings{
  display: inline-flex;
}
#NWsectionTitle  {
  font-size: 40pt;
  line-height: 200px;
  top: 12vh;
  left: 3vw;
}
#sectionTitle  {
  font-size: 30pt;
  line-height: 20px;
  top: 12vh;
}


#floor-choice{
  display: inline-flex;
}

#locker-choice{
  display: inline-flex;
}

#cfmPage{
  position: absolute;
  top: 50%;
  left: 50%;
  margin-right: - 50%;
  transform: translate(-50%, -50%)

}

#counterNW {
  text-decoration: underline;
  font-size: 30pt;
}
#counterSW {
  text-decoration: underline;
  font-size: 30pt
}
#counterNE {
  text-decoration: underline;
  font-size: 30pt
}
#counterSE {
  text-decoration: underline;
  font-size: 30pt
}
  </style>


</head>

<body>
  <div id="headerContainer">
    <div id="header">

      <div class="spinner-grow" role="status">
        <span class="sr-only">Loading...</span>
      </div>

      <img src=img/_Logo.png id="logo" alt="logo" />

       <div class="dropdown open">
        <input type=image src="img/profile.png" class="btn btn-secondary dropdown-toggle"
          data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" id="profile" alt="profilePic">

        <!--  </button>-->
        <div class="dropdown-menu">
          <button class="dropdown-item" onclick="showCurrent()">Locker Info</button>
          <div class="dropdown-divider"></div>
          <a class="dropdown-item" href="lockermanagement.html">Locker Management</a>
          <a class="dropdown-item" id="logout">Logout</a>
        </div>
      </div>


    </div>


  </div>

  <div id="promptBox" class="alert alert-success" role="alert">
    <span id="locationIndicator"></span>
    <span>Please Choose a <span id="choosingScope">section</span> to view the available lockers</span>
  </div>

  <!--A div that allows the user to choose a section to view avaiable lockers-->
  <div id="sectionChoice" class="1stuff">
    <div id="NW" class="1">
      <div>
        <span id='NWsectionTitle'>NW</span> <p> <span id="counterNW"> </span> available lockers left</p>
      </div>
    </div>
    <div id="NE" class="1">
      <span id='NWsectionTitle'>NE:</span> <p> <span id="counterNE"> </span> <span>available lockers left</span> </p>
    </div>
    <div id="SW" class="1"><span id='NWsectionTitle'>SW:</span> <p> <span id="counterSW"> </span> <span>available lockers left</span> </p>
    </div>
    <div id="SE" class="1"><span id='NWsectionTitle'>SE:</span> <p> <span id="counterSE"> </span> <span>available lockers left</span> </p>
    </div>
  </div>


  <!--A div that allows the user to choose a building to view avaiable lockers-->
  <div id="buildings">
    <div id="NW-buildings" class="2">
      <div id="NW3"><button type="button" class="btn btn-secondary btn-lg, btnbuilding" id="NW3Btn"
          name="NW3">NW3</button><span>NW3</span> <span id="NW3data"> </span> <span>available lockers left</span></div>

      <div id="NW1"><button type="button" class="btn btn-secondary btn-lg, btnbuilding" id="NW1Btn"
          name="NW1">NW1</button><span>NW1:</span> <span id="NW1data"> </span> <span>available lockers left</span></div>

      <div id="NW5"><button type="button" class="btn btn-secondary btn-lg, btnbuilding" id="NW5Btn"
          name="NW5">NW5</button><span>NW5</span> <span id="NW5data"> </span> <span>available lockers left</span></div>

      <div id="NW6"><button type="button" class="btn btn-secondary btn-lg, btnbuilding" id="NW6Btn"
          name="NW6">NW6</button><span>NW6:</span> <span id="NW6data"> </span> <span>available lockers left</span></div>

    </div>

    <div id="NE-buildings" class="2">

      <div id="NE1"><button type="button" class="btn btn-secondary btn-lg, btnbuilding" id="NE1Btn"
          name="NE1">NE1</button><span>NE1:</span> <span id="NE1data"> </span> <span>available lockers left</span></div>

      <div id="NE2"><button type="button" class="btn btn-secondary btn-lg, btnbuilding" id="NE2Btn"
          name="NE2">NE2</button><span>NE2</span> <span id="NE2data"> </span> <span>available lockers left</span></div>

      <div id="NE3"><button type="button" class="btn btn-secondary btn-lg, btnbuilding" id="NE3Btn"
          name="NE3">NE3</button><span>NE3</span> <span id="NE3data"> </span> <span>available lockers left</span></div>

      <div id="NE4"><button type="button" class="btn btn-secondary btn-lg, btnbuilding" id="NE4Btn"
          name="NE4">NE4</button><span>NE4:</span> <span id="NE4data"> </span> <span>available lockers left</span></div>

    </div>

    <div id="SE-buildings" class="2">

      <div id="SE1"><button type="button" class="btn btn-secondary btn-lg, btnbuilding" id="SE1Btn"
          name="SE1">SE1</button><span>SE1:</span> <span id="SE1data"> </span> <span>available lockers left</span></div>

      <div id="SE2"><button type="button" class="btn btn-secondary btn-lg, btnbuilding" id="SE2Btn"
          name="SE2">SE2</button><span>SE2</span> <span id="SE2data"> </span> <span>available lockers left</span></div>

      <div id="SE3"><button type="button" class="btn btn-secondary btn-lg, btnbuilding" id="SE3Btn"
          name="SE3">SE3</button><span>SE3</span> <span id="SE3data"> </span> <span>available lockers left</span></div>

      <div id="SE4"><button type="button" class="btn btn-secondary btn-lg, btnbuilding" id="SE4Btn"
          name="SE4">SE4</button><span>SE4:</span> <span id="SE4data"> </span> <span>available lockers left</span></div>

    </div>

    <div id="SW-buildings" class="2">
      <div id="SW1"><button type="button" class="btn btn-secondary btn-lg, btnbuilding" id="SW1Btn"
          name="SW1">SW1</button><span>SW1</span> <span id="SW1data"> </span> <span>available lockers left</span></div>

      <div id="SW2"><button type="button" class="btn btn-secondary btn-lg, btnbuilding" id="SW2Btn"
          name="SW2">SW2</button> <span>SW2: </span> <span id="SW2data"> </span> <span>available lockers left</span>
      </div>

      <div id="SW3"><button type="button" class="btn btn-secondary btn-lg, btnbuilding" id="SW3Btn"
          name="SW3">SW3</button><span>SW3: </span> <span id="SW3data"> </span> <span>available lockers left</span>
      </div>

      <div id="SW5"><button type="button" class="btn btn-secondary btn-lg, btnbuilding" id="SW5Btn"
          name="SW5">SW5</button><span>SW5: </span> <span id="SW5data"> </span> <span>available lockers left</span>
      </div>

      <div id="SW9"><button type="button" class="btn btn-secondary btn-lg, btnbuilding" id="SW9Btn"
          name="SW9">SW9</button><span>SW9: </span> <span id="SW9data"> </span> <span>available lockers left</span>
      </div>
    </div>

    <div id="floor-choice" class="3stuff">
      <div id="b1Div"><button type="button" class="btn btn-secondary btn-lg, btnFloor, 3" id="b1"
          name="b1">b1</button><span>1F</span> <span id="b1data"> </span> <span>available lockers left</span></div>

      <div id="1fDiv"><button type="button" class="btn btn-secondary btn-lg, btnFloor, 3" id="1f"
          name="1f">1f</button><span>1F</span> <span id="1Fdata"> </span> <span>available lockers left</span></div>

      <div id="2fDiv"><button type="button" class="btn btn-secondary btn-lg, btnFloor, 3" id="2f"
          name="2f">2f</button><span>1F</span> <span id="2Fdata"> </span> <span>available lockers left</span></div>

      <div id="3fDiv"><button type="button" class="btn btn-secondary btn-lg, btnFloor, 3" id="3f"
          name="3f">3f</button><span>1F</span> <span id="3Fdata"> </span> <span>available lockers left</span></div>

    </div>

    <div id="locker-choice" class="4stuff">
      <div><button type="button" class="btn btn-secondary btn-lg, btnLocker, 4" id="1111"
          name="b1">1011</button><span>1F</span>  </div>

      <div><button type="button" class="btn btn-secondary btn-lg, btnLocker, 4" id="2222"
          name="1f">2022</button><span>1F</span>  </div>

      <div><button type="button" class="btn btn-secondary btn-lg, btnLocker, 4" id="3333"
          name="2f">3033</button><span>1F</span> </div>

      <div><button type="button" class="btn btn-secondary btn-lg, btnLocker, 4" id="4444"
          name="3f">4044</button><span>1F</span>  </div>

    </div>

    <div class="0stuff" id="lockerChoice">
      <form>
        <input type="text" id='searchByID'>
        <br />
        <input type="submit">
      </form>

    </div>
<!--      confirm/go back button is not working-->
    <div id="cfmPage">
   <div class="card">
  <img class="card-img-top" src="./img/lockermanagement_background.jpg" alt="Card image cap">
  <div class="card-body">
    <h4 class="card-title" style="color: brown">Confirmation</h4>
    <p class="card-text" id="showConfirmationLockerPosition">
      you are currently at
    </p>
    <a href="#!" class="btn btn-primary" id="confirm">confirm</a>
  </div>
</div>
  </div>
    <!-- the id of the <div> is not necessarily used -->
    <div id="goBackBtnDiv">
      <button id="goBackBtn">goBack</button>
    </div>

  </div>

  <!-- Bootstrap for Mobile-first -->
<!--  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" itemprop="" property="">-->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

  <!-- Add Firebase products that you want to use -->
  <script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-firestore.js"></script>
  <script src="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.js"></script>




  <script>
    //the "step" variable stores which stage(section, building, floor, certain locker) the process is at.
    var step = 1;

    //a variable that stores the information of the building just entered
    var backQuery_building;

    //a variable that stores the information of the sector just entered
    var backQuery_section;

    function stepControl() {
      switch (step) {
        //case 1, the very first step is to choose a section(e.g. NE,SW)
        //goBackBtn is not shown, because it is not needed.
        case 0:
          $(".0stuff").show();
        case 1:
          $(".0stuff").hide();
          $("#goBackBtn").hide();
          $(".1stuff").show();
          $(".2").hide();
          $(".3stuff").hide();
          $(".4stuff").hide();
          $("#choosingScope").html("section");
          /*whenever it comes back to step 1, backQuery should become 'null', because
          if not so, when going back to step 2, it becomes a rat.*/
          backQuery_section = null;
          $("#locationIndicator").html("");
          $("#cfmPage").hide();
          break;


        /*In case 2, it allows you to press the goBackBtn
          If you come back from case 3, it also knows what blocks of building you chose.
        */
        case 2:

          $(`#${backQuery_section}` + "-buildings").show();
          //from case 2, it allows you to press the goBackBtn
          $("#goBackBtn").show();
          $("#choosingScope").html("Building");
          $(".3stuff").hide();
          $(".4stuff").hide();
          $("#cfmPage").hide();
          $("#locationIndicator").html("You are currently in Section " + backQuery_section);
          backQuery_building = null;
          break;


        case 3:

          $(backQuery_building).show();
          $("#sectionChoice").hide();
          $(".2").hide();
          $(".3stuff").show();
          $(".4stuff").hide();
          $("#cfmPage").hide();
          $("#choosingScope").html("Floor");
          break;

        case 4:

          $(".3stuff").hide();
          $("#locker-choice").show();
          $("#choosingScope").html("number");
          $("#cfmPage").hide();
          $("#loginBtn").hide();

          break;

        case 5:
        $(".3stuff").hide();
        $(".4stuff").hide();
          $("#locker-choice").show();
          $("#choosingScope").html("number");
          $("#cfmPage").show();
          $("#goBackBtn").css("position","relative");
          $("#goBackBtn").css("left","49vw");
          $("#goBackBtn").css("top","21.5vh");
          break;
      }
    }


    $(".1").click(function () {
      backQuery_section = `${this.id}`;

      //      var sectionNum = $(e.target).attr("id");
      console.log("you picked section " + `${this.id}`);
      //      console.log("#" + sectionNum);


      //When the specific section is pressed, the buttons in that section will show up.
      $(`#${this.id}` + "-buildings").show();

      //Hides whatever not related to the step
      $("#sectionChoice").hide();

      step = 2;
      stepControl();


      //shows the vacancy in buildings of the section.
      showBuildingVacancy(`${this.id}`);

      $("#locationIndicator").css("color", "red");
      $("#locationIndicator").css("font-size", "5vw");
    });





    //    The Following is a sample block of code, which was replaced by the above funciton

    /*

    $("#NW").click(function(){
      $("#NW-buildings").show();
      $("#sectionChoice").hide();
      step=2;
      stepControl();
      backQuery="#NW-buildings";
    });
    */





    $("#goBackBtn").click(function () {
      console.log(step);
      step--;
      stepControl();
      console.log("at step " + step)

    });


    //while in step 2, the user chooses a building
    //during this step, buttons representing different buildings are shown to the user
    var buildingButton = $(".btnbuilding");

    //when the user clicks the button, it does the following:
    /*
      1.gets the building number, changes the display in the status box.
      2.enters the next step
      3.returns the buildingNum, and the return is to be used to access the database
      to get data.

    */

    //At the level of building choice, it does the following:
    //When being clicked, it starts the chain reaction:
    var building_Num;
    $(buildingButton).click(function (e) {
      // var collectionSection = sections[i].getAttribute("id");
      //#1-1 the variable "buildingNum" gets the attribute of "name"
      let buildingNum = $(e.target).attr("name");
      building_Num=buildingNum;

      //#1-2 the variable "backQuery_building" holds which building it is in.
      backQuery_building = buildingNum;
      console.log("Current Building is ", buildingNum);

      //#1-3 "step=3" means the locker-picking function goes to the level of building.
      step = 3;


      $("#locationIndicator").css("color", "red");
      $("#locationIndicator").css("font-size", "5vw");
      $("#locationIndicator").html("You are currently in Building" + buildingNum);
      console.log(backQuery_section);
      stepControl();
    });

//Step 4
    var floor_Num;
    var floorButton = $(".3");
      $(floorButton).click(function (e) {
      // var collectionSection = sections[i].getAttribute("id");
      //#1-1 the variable "buildingNum" gets the attribute of "name"
      let floorNum = $(e.target).attr("id");
        floor_Num=floorNum;

      //#1-2 the variable "backQuery_building" holds which building it is in.

      console.log("Current floor is ", floorNum);

      //#1-3 "step=3" means the locker-picking function goes to the level of building.
      step = 4;


      $("#locationIndicator").css("color", "red");
      $("#locationIndicator").css("font-size", "5vw");
      $("#locationIndicator").html("You are currently in floor" + floorNum);
      console.log("This is in building "+ backQuery_building);
      stepControl();
    });

    //Step 5
    var locker_Num;
    var lockerButton = $(".4");
      $(lockerButton).click(function (e) {
      // var collectionSection = sections[i].getAttribute("id");
      //#1-1 the variable "buildingNum" gets the attribute of "name"
      let lockerNum = $(e.target).attr("id");
        locker_Num=lockerNum;

      //#1-2 the variable "backQuery_building" holds which building it is in.

      console.log("Current floor is ", lockerNum);

      //#1-3 "step=3" means the locker-picking function goes to the level of building.
      step = 5;


          firebase.auth().onAuthStateChanged(function (user) {


    if(user == null){

      $("#showConfirmationLockerPosition").html("please login before reserving for a locker")
      $("#confirm").hide();

      var loginBtn = $("<button id='loginBtn'><a href='./login.html'>Login</a></button>");
      $("#confirm").after(loginBtn);
      }
     })


      $("#locationIndicator").css("color", "red");
      $("#locationIndicator").css("font-size", "5vw");
      $("#locationIndicator").html("You currently chosen " + lockerNum);
      $("#showConfirmationLockerPosition").html("You have currently chosen" + lockerNum + " on " + floor_Num + "loor, of building" +building_Num);
      console.log("This is in building "+ backQuery_building);
      stepControl();
    });
  </script>

  <!--Integrated firebase settings-->
  <script src="./scripts/firebase_config.js"></script>

  <script>

    function showSectionVacancy() {


      db.collection('lockerinfo').doc('nqsuYINSdLRJSCJBEO9G').onSnapshot(function (snap) {
        $("#counterNE").html(snap.data().NE);
        $("#counterNW").html(snap.data().NW);
        $("#counterSW").html(snap.data().SW);
        $("#counterSE").html(snap.data().SE);
      });


    }
    //This function shows the number of locker vacancy information
    //It is invoked by clicking on the section divs.
    function showBuildingVacancy(sections) {

       /*
        if the building thingy belongs to a section, just trasverse the session,
      for each of the button span in the section, it get access the database once.
      */
      db.collection("lockerinfo").doc("nqsuYINSdLRJSCJBEO9G").collection(sections).onSnapshot(function (snap) {
        snap.forEach(function (doc) {
          console.log("Document data:", doc.data().vacant_lockers);
          console.log(doc.id);
          $("#" + doc.id + "data").html(doc.data().vacant_lockers);

        });
      });


      //these are the ways to test "start with" :
      //      alert(buildingSW[1].getAttribute('id').startsWith("SW"));
      //      alert(buildingButton[0].getAttribute('name').startsWith());

      //      var buildingNW = $('.btnbuildingNW');
      //      var floors = $()
      //      alert(sections[0].getAttribute("id"));


      //      for(var i in sections){








    }

    //When first executed, the step is 1.
    stepControl();

    //Section vacancy is shown, upon loading the page.
    showSectionVacancy();




     $("#logout").click(function () {
        firebase.auth().signOut();
        window.location.href = './login.html';
      })






$("#confirm").click(function(event){
  firebase.auth().onAuthStateChanged(function (user){


 db.collection("user").doc(user.uid).collection("position").doc("lockerInfo").set(
          {
            locker: [locker_Num]
          })

          .then(function () {
            console.log(locker_Num);
          })
          .catch(function (error) {
            console.error("Error writing document: ", error);
          });
})
})







//    $(".SW-buildings").click(function(){
//         var SW = $("button[name^='SW']");
//      var SWlist = [1];
//      SWlist.push(SW.forEach());
//      let buildingNum = -1;
//      SWlist[]
//
//    })

  </script>
</body>

</html>
