<!DOCTYPE html>
<html lang="en">

<head>
  <title>Personal Locker Management</title>

  <meta charset="utf-8" />

  
  <link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.css" />
  
  <!--This file works as the overall stylesheet for the project-->
  <link type="text/css" rel="stylesheet" href="style/lockermanagement.css">

  <!--This file works as the overall stylesheet for lockermap-->
  <link type="text/css" rel="stylesheet" href="style/lockermap.css">

  
</head>

<body>
  <div id="headerContainer">
    <div id="header">

      <div class="spinner-grow" role="status">
        <span class="sr-only">Loading...</span>
      </div>

      <img src=img/logo.png id="logo" alt="logo"/>

      <img src="img/profile.png" id="profile" alt="profilePic" />

    </div>


  </div>

  <div id="promptBox" class="alert alert-success" role="alert">
    <span id="locationIndicator"></span>
    <span>Please Choose a <span id="choosingScope">section</span> to view the available lockers</span>
  </div>
  
  <!--A div that allows the user to choose a section to view avaiable lockers-->
  <div id="sectionChoice" class="1stuff">
    <div id="NW" name='NW' class="1"><span>NW:</span> <span id="counterNW"> </span> <span>available lockers left</span></div>
    <div id="NE" name='NE' class="1"><span>NE:</span> <span id="counterNE"> </span> <span>available lockers left</span></div>
    <div id="SW" name='SW' class="1"><span>SW:</span> <span id="counterSW"> </span> <span>available lockers left</span></div>
    <div id="SE" name='SW' class="1"><span>SE:</span> <span id="counterSE"> </span> <span>available lockers left</span></div>
  </div>
  
  
  <!--A div that allows the user to choose a building to view avaiable lockers-->
  <div id="buildings">
    <div id="NW-buildings" class="2">
      <div id="NW3"><button type="button" class="btn btn-secondary btn-lg, btnbuilding" id="NW3Btn" name="NW3" >NW3</button><span>NW3</span> <span id="NW3data"> </span> <span>available lockers left</span></div>

      <div id="NW1"><button type="button" class="btn btn-secondary btn-lg, btnbuilding" id="NW1Btn" name="NW1" >NW1</button><span>NW1:</span> <span id="NW1data"> </span> <span>available lockers left</span></div>

      <div id="NW5"><button type="button" class="btn btn-secondary btn-lg, btnbuilding" id="NW5Btn" name="NW5" >NW5</button><span>NW5</span> <span id="NW5data"> </span> <span>available lockers left</span></div>

      <div id="NW6"><button type="button" class="btn btn-secondary btn-lg, btnbuilding" id="NW6Btn" name="NW6">NW6</button><span>NW6:</span> <span id="NW6data"> </span> <span>available lockers left</span></div>

    </div>
  
    <div id="SW-buildings" class="2">
      <div id="SW1"><button type="button" class="btn btn-secondary btn-lg, btnbuilding" id="SW1Btn" name="SW1" >SW1</button><span>SW1</span> <span id="SW1data"> </span> <span>available lockers left</span></div>

      <div id="SW2"><button type="button" class="btn btn-secondary btn-lg, btnbuilding" id="SW2Btn" name="SW2">SW2</button> <span>SW2: </span> <span id="SW2data"> </span> <span>available lockers left</span></div>

      <div id="SW3"><button type="button" class="btn btn-secondary btn-lg, btnbuilding" id="SW3Btn" name="SW3">SW3</button><span>SW3: </span> <span id="SW3data"> </span> <span>available lockers left</span></div>

      <div id="SW5"><button type="button" class="btn btn-secondary btn-lg, btnbuilding" id="SW5Btn" name="SW5">SW5</button><span>SW5: </span> <span id="SW5data"> </span> <span>available lockers left</span></div>

      <div id="SW9"><button type="button" class="btn btn-secondary btn-lg, btnbuilding" id="SW9Btn" name="SW9">SW9</button><span>SW9: </span> <span id="SW9data"> </span> <span>available lockers left</span></div>
    </div>
    
    <div class="3" id="floors">
      
    </div>
    
    <!-- the id of the <div> is not necessarily used -->
    <div id="goBackBtnDiv">
      <button id="goBackBtn">goBack</button>
    </div>
    
  </div>
 
  <!-- Bootstrap for Mobile-first -->
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

  <!-- Add Firebase products that you want to use -->
  <script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-firestore.js"></script>
  <script src="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.js"></script>
    
    
  
  
  <script>
     //the "step" variable stores which stage(section, building, floor, certain locker) the process is at.
    var step = 1;
    
    //a variable that stores the information of the building just entered
    var backQuery_building;
    
     //a variable that stores the information of the sector just entered
    var backQuery_section;
    
    function stepControl(){
      switch(step) {
        //case 1, the very first step is to choose a section(e.g. NE,SW)
        //goBackBtn is not shown, because it is not needed.
        case 1:
          $("#goBackBtn").hide();
          $(".1stuff").show();
          $(".2").hide();
          $("#choosingScope").html("section");
          /*whenever it comes back to step 1, backQuery should become 'null', because
          if not so, when going back to step 2, it becomes a rat.*/
          backQuery_section=null;
          $("#locationIndicator").html("");
          break;

         
        /*In case 2, it allows you to press the goBackBtn
          If you come back from case 3, it also knows what blocks of building you chose.
        */
        case 2:
          $(`#${backQuery_section}`+"-buildings").show();
          $("#goBackBtn").show();
          $("#choosingScope").html("Building");
          $("#locationIndicator").html("You are currently in Section " + backQuery_section);
          backQuery_building=null;
          break;
        
        //In case 2, it allows you to press the goBackBtn
        case 3:
          $(backQuery_building).show();
          $("#sectionChoice").hide();
          $(".2").hide();
          $(".3").show();
          $("#choosingScope").html("Floor");
          break;
          
        case 4:
          $("#choosingScope").html("number");
          break;
      }
    }
    

    $(".1").click(function(){
      backQuery_section=`${this.id}`;
      
//      var sectionNum = $(e.target).attr("id");
      console.log(`${this.id}`);
//      console.log("#" + sectionNum);
      
       $(`#${this.id}`+"-buildings").show();
      
     // $(`#${backQuery_section}`+"-buildings").show();
      
//      $('#'+ sectionNum).show();
        $("#sectionChoice").hide();
        step=2;
        stepControl();
        
        $("#locationIndicator").css("color","red");
        $("#locationIndicator").css("font-size","5vw");
    });

    
    
    
    
//    The Following is a sample block of code, which was replaced by the above funciton
    
    /*
      
    $("#NW").click(function(){
      $("#NW-buildings").show();
      $("#sectionChoice").hide();
      step=2;
      stepControl();
      backQuery="#NW-buildings";
    });
    */


    
    
    
    $("#goBackBtn").click(function(){
      console.log(step);
      step--;
      stepControl();

    });
    
    
    
    
    
    
    
    
    
    
    
    //while in step 2, the user chooses a building
    //during this step, buttons representing different buildings are shown to the user
    var buildingButton = $(".btnbuilding");
    
    //when the user clicks the button, it does the following:
    /*
      1.gets the building number, changes the display in the status box.
      2.enters the next step
      3.returns the buildingNum, and the return is to be used to access the database
      to get data.
      
    */
    
    $(buildingButton).click(function(e){
          
           
            var buildingNum = $(e.target).attr("name");
            
            backQuery_building=buildingNum;
            
            console.log("Current Building is ", buildingNum);

            step = 3;
            

            $("#locationIndicator").css("color","red");
            $("#locationIndicator").css("font-size","5vw");
            $("#locationIndicator").html("You are currently in Building" + buildingNum );
      console.log(backQuery_section);
      stepControl();
       
     });
    
    var firebaseConfig = {
      apiKey: "AIzaSyASFWH5KsgmLDY3HcRUmDIwbFtYv5Ayf8o",
      authDomain: "bcit-lockers.firebaseapp.com",
      databaseURL: "https://bcit-lockers.firebaseio.com",
      projectId: "bcit-lockers",
      storageBucket: "bcit-lockers.appspot.com",
      messagingSenderId: "380958555512",
      appId: "1:380958555512:web:3a1928344614d15da51c8d",
      measurementId: "G-R8V8WMCJRB"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    var db = firebase.firestore();
    
    //This function shows the number of locker vacancy information
    function showVacancy() {
      
    db.collection('lockerinfo').doc('nqsuYINSdLRJSCJBEO9G').collection('NE').doc('NE1').onSnapshot(function(snap){
          $("#NE1").html(snap.data().vacant_lockers);
      })
                                                                       
    db.collection('lockerinfo').doc('nqsuYINSdLRJSCJBEO9G').onSnapshot(function(snap){
          $("#counterNE").html(snap.data().NE);
          $("#counterNW").html(snap.data().NW);
          $("#counterSW").html(snap.data().SW);
          $("#counterSE").html(snap.data().SE);
      })
}
    
    
    
    
    //shows the vacancies through accessing firebase
    showVacancy();
    
    //When first executed, the step is 1.
    stepControl();
    
  
   
  

    
    
    
    
//    $(".SW-buildings").click(function(){
//         var SW = $("button[name^='SW']");
//      var SWlist = [1];
//      SWlist.push(SW.forEach());
//      let buildingNum = -1;
//      SWlist[]
//
//    })
    
  </script>
</body>

</html>
