<!doctype html>
<html>

    <meta charset="utf-8">
    <title></title>
    <head>
    <title>Login-BCIT_LOCKERs</title>
    <!-- Insert these scripts at the bottom of the HTML, but before you use any Firebase services -->

    <!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/7.2.3/firebase-app.js"></script>

<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
<script src="https://www.gstatic.com/firebasejs/7.2.3/firebase-analytics.js"></script>
      
    <!-- Add Firebase products that you want to use -->
    <script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-firestore.js"></script>

    <!--Authentication Sign in with a pre-built UI-->
    <script src="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.js"></script>
    <link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.css" />
    <link type="text/css" rel="stylesheet" href="./style/changelocker.css" />
      
<style>
 
  
 
  
</style>
  
  <script>
  // Your web app's Firebase configuration
  var firebaseConfig = {
    apiKey: "AIzaSyASFWH5KsgmLDY3HcRUmDIwbFtYv5Ayf8o",
    authDomain: "bcit-lockers.firebaseapp.com",
    databaseURL: "https://bcit-lockers.firebaseio.com",
    projectId: "bcit-lockers",
    storageBucket: "bcit-lockers.appspot.com",
    messagingSenderId: "380958555512",
    appId: "1:380958555512:web:3a1928344614d15da51c8d",
    measurementId: "G-R8V8WMCJRB"
  };
  // Initialize Firebase
  
  firebase.initializeApp(firebaseConfig);
  firebase.analytics();
</script>
</head>
  
  
<body>
  <div id="head">
  <div id="intro">
    
    
  <h1 id="Welcome">Change locker position</h1>
 
  </div>
  

  
  <div id="headerContainer">
    <div id="header">
      </div>

      <img src=img/logo.png id="logo" alt="logo" />

    </div>
  </div>
  <div id="questions">
      <h3>Provide information for changing locker solution</h3>
      <span><strong>May take at most 48 hours to be processed</strong></span>

    <form>
      <br>When did you choose your current locker?(Approximately)<br>
      <input type="date" id="startDate" min="2019-01-01" max="2100-01-01"><br/>
      <br>Please provide your BCIT ID<br>
       <input type="text" name="ID" id="stuID"><br/>
      <br>Please provide your my.BCIT email<br>
      <input type="email" id="stuEmail"><br/>
      <br>Please state the reason to change.<br>
      <input type="text" id="reason"><br/>
      <br>
      <button onclick="dbUpdate()" id="submit">submit</button>
      <br/>

    </form>
    </div>
  
<script>
//createUser() deleted
var db = firebase.firestore();
    // if the current user logged in user
    // is authenticated, then grab "uid" "displayName" and "email"
    // use "set()" with merge (if document did not exist it will be created)
    firebase.auth().onAuthStateChanged(function(user){
        console.log(user);
        db.collection("user").doc(user.uid).set(
    	{
         
        "name":user.displayName,
         "studentname":user.email,
        },{ merge: true });
    });


function dbUpdate() {

  //  document.getElementById("startDate").value;
  // alert(document.getElementById("startDate").value);

  Q1 = document.getElementById("stuID").value;

  
  Q2 = document.getElementById("stuEmail").value;

  
  Q3 = document.getElementById("reason").value;


  Q4 = document.getElementById("startDate").value;

  
  //Now, when the user goes to the changelocker.html page, the user can fill in a
  //table. When the table is submitted, the page would send the form to the firestore.
  //"change_request" is the collection node, and the Q1 variable is the studentID
  //The function generates a list at document level, which has the same name as the ID. The info is put into the database as field key value pairs. This is for the customer service to get a report on the request.
  db.collection("change_request").doc("all").collection("cases").doc(Q1).set({
   stuID: Q1 ,
   stuEmail : Q2,
   reason :  Q3,
   startDate :  Q4
  })
  
  .then(function() {
    console.log("Document successfully written!");
  })
  .catch(function(error) {
    console.error("Error writing document: ", error);
  });
}

</script>


</body>
</html>

